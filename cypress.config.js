/**
 * Cypress E2E í…ŒìŠ¤íŠ¸ ì„¤ì • íŒŒì¼
 * 
 * KM í¬í„¸ í”„ë¡ íŠ¸ì—”ë“œì˜ E2E(End-to-End) í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ êµ¬ì„±í•©ë‹ˆë‹¤.
 * 
 * [ì„¤ì • í•­ëª©]
 * - baseUrl: í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ì• í”Œë¦¬ì¼€ì´ì…˜ URL
 * - viewportWidth/Height: í…ŒìŠ¤íŠ¸ ë¸Œë¼ìš°ì € í¬ê¸°
 * - video: í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì˜ìƒ ë…¹í™” ì—¬ë¶€
 * - screenshotOnRunFailure: ì‹¤íŒ¨ ì‹œ ìŠ¤í¬ë¦°ìƒ· ì´¬ì˜
 * 
 * íŒŒì¼ ìœ„ì¹˜: km-portal-frontend/cypress.config.js
 * 
 * ì‘ì„±ì¼: 2025ë…„ 11ì›” 30ì¼ (41ì¼ì°¨)
 * ì‘ì„±ì: KM Portal Dev Team
 */

const { defineConfig } = require('cypress')

module.exports = defineConfig({
  // ====================================
  // E2E í…ŒìŠ¤íŠ¸ ì„¤ì •
  // ====================================
  e2e: {
    /**
     * ê¸°ë³¸ URL ì„¤ì •
     * cy.visit('/login')ì€ http://localhost:3000/loginìœ¼ë¡œ í•´ì„ë¨
     */
    baseUrl: 'http://localhost:3000',

    /**
     * í…ŒìŠ¤íŠ¸ íŒŒì¼ íŒ¨í„´
     * cypress/e2e í´ë” ë‚´ì˜ ëª¨ë“  .cy.js íŒŒì¼ì„ í…ŒìŠ¤íŠ¸ë¡œ ì¸ì‹
     */
    specPattern: 'cypress/e2e/**/*.cy.{js,jsx,ts,tsx}',

    /**
     * ì§€ì› íŒŒì¼ ê²½ë¡œ
     * ì»¤ìŠ¤í…€ ëª…ë ¹ì–´ì™€ ì „ì—­ ì„¤ì •ì´ í¬í•¨ëœ íŒŒì¼
     */
    supportFile: 'cypress/support/e2e.js',

    /**
     * ê° í…ŒìŠ¤íŠ¸ ì „ ìƒíƒœ ì´ˆê¸°í™”
     * trueë¡œ ì„¤ì •í•˜ë©´ ê° í…ŒìŠ¤íŠ¸ ê°„ ì¿ í‚¤, ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë“±ì´ ìœ ì§€ë¨
     */
    experimentalSessionAndOrigin: true,

    /**
     * ì„¤ì • í•¨ìˆ˜
     * í”ŒëŸ¬ê·¸ì¸ì´ë‚˜ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì„¤ì •í•  ë•Œ ì‚¬ìš©
     */
    setupNodeEvents(on, config) {
      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
      
      // í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì „ ë¡œê·¸
      on('before:run', (details) => {
        console.log('ğŸš€ KM í¬í„¸ E2E í…ŒìŠ¤íŠ¸ ì‹œì‘')
        console.log(`   ì´ ${details.specs.length}ê°œ ìŠ¤í™ íŒŒì¼`)
      })

      // í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„ ë¡œê·¸
      on('after:run', (results) => {
        console.log('âœ… KM í¬í„¸ E2E í…ŒìŠ¤íŠ¸ ì™„ë£Œ')
        console.log(`   í†µê³¼: ${results.totalPassed}, ì‹¤íŒ¨: ${results.totalFailed}`)
      })

      return config
    },
  },

  // ====================================
  // ë¸Œë¼ìš°ì € ë·°í¬íŠ¸ ì„¤ì •
  // ====================================
  
  /**
   * ê¸°ë³¸ ë·°í¬íŠ¸ í¬ê¸° (1280x720)
   * ë°ìŠ¤í¬í†± í™˜ê²½ ê¸°ì¤€
   */
  viewportWidth: 1280,
  viewportHeight: 720,

  // ====================================
  // ì˜ìƒ ë° ìŠ¤í¬ë¦°ìƒ· ì„¤ì •
  // ====================================

  /**
   * í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì˜ìƒ ë…¹í™”
   * CI/CD í™˜ê²½ì—ì„œëŠ” falseë¡œ ì„¤ì •í•˜ì—¬ ì†ë„ í–¥ìƒ ê°€ëŠ¥
   */
  video: true,

  /**
   * ì˜ìƒ ì••ì¶• í’ˆì§ˆ (0-51, ë‚®ì„ìˆ˜ë¡ ê³ í’ˆì§ˆ)
   */
  videoCompression: 32,

  /**
   * ì‹¤íŒ¨ ì‹œ ìŠ¤í¬ë¦°ìƒ· ì´¬ì˜
   */
  screenshotOnRunFailure: true,

  /**
   * ìŠ¤í¬ë¦°ìƒ· ì €ì¥ í´ë”
   */
  screenshotsFolder: 'cypress/screenshots',

  /**
   * ì˜ìƒ ì €ì¥ í´ë”
   */
  videosFolder: 'cypress/videos',

  // ====================================
  // íƒ€ì„ì•„ì›ƒ ì„¤ì •
  // ====================================

  /**
   * ê¸°ë³¸ ëª…ë ¹ì–´ íƒ€ì„ì•„ì›ƒ (ë°€ë¦¬ì´ˆ)
   * cy.get(), cy.click() ë“±ì˜ ê¸°ë³¸ ëŒ€ê¸° ì‹œê°„
   */
  defaultCommandTimeout: 10000,

  /**
   * í˜ì´ì§€ ë¡œë“œ íƒ€ì„ì•„ì›ƒ (ë°€ë¦¬ì´ˆ)
   * cy.visit() ì‹œ í˜ì´ì§€ ë¡œë“œ ëŒ€ê¸° ì‹œê°„
   */
  pageLoadTimeout: 30000,

  /**
   * ìš”ì²­ íƒ€ì„ì•„ì›ƒ (ë°€ë¦¬ì´ˆ)
   * cy.request() ì‹œ ì‘ë‹µ ëŒ€ê¸° ì‹œê°„
   */
  requestTimeout: 10000,

  /**
   * ì‘ë‹µ íƒ€ì„ì•„ì›ƒ (ë°€ë¦¬ì´ˆ)
   * cy.intercept()ë¡œ ê°€ë¡œì±ˆ ìš”ì²­ì˜ ì‘ë‹µ ëŒ€ê¸° ì‹œê°„
   */
  responseTimeout: 30000,

  // ====================================
  // ì¬ì‹œë„ ì„¤ì •
  // ====================================

  /**
   * ì‹¤íŒ¨í•œ í…ŒìŠ¤íŠ¸ ì¬ì‹œë„ íšŸìˆ˜
   * ë¶ˆì•ˆì •í•œ í…ŒìŠ¤íŠ¸ì— ëŒ€í•œ ì•ˆì •ì„± í–¥ìƒ
   */
  retries: {
    // ë¡œì»¬ ì‹¤í–‰ ì‹œ ì¬ì‹œë„ ì—†ìŒ (ë¹ ë¥¸ í”¼ë“œë°±)
    runMode: 2,      // CI/CDì—ì„œ ì‹¤í–‰ ì‹œ 2íšŒ ì¬ì‹œë„
    openMode: 0      // ëŒ€í™”í˜• ëª¨ë“œì—ì„œëŠ” ì¬ì‹œë„ ì—†ìŒ
  },

  // ====================================
  // í™˜ê²½ ë³€ìˆ˜
  // ====================================

  /**
   * í…ŒìŠ¤íŠ¸ì—ì„œ ì‚¬ìš©í•  í™˜ê²½ ë³€ìˆ˜
   * Cypress.env('ë³€ìˆ˜ëª…')ìœ¼ë¡œ ì ‘ê·¼
   */
  env: {
    // API ê¸°ë³¸ URL
    apiUrl: 'http://localhost:8080/api',

    // í…ŒìŠ¤íŠ¸ ê³„ì • ì •ë³´
    testUser: {
      username: 'testuser',
      password: 'password123'
    },

    // ê´€ë¦¬ì ê³„ì • ì •ë³´
    adminUser: {
      username: 'admin',
      password: 'admin123'
    },

    // ì»¤ë²„ë¦¬ì§€ ìˆ˜ì§‘ ì—¬ë¶€
    codeCoverage: false
  },

  // ====================================
  // ì‹¤í—˜ì  ê¸°ëŠ¥
  // ====================================

  /**
   * ì‹¤í—˜ì  ê¸°ëŠ¥ í™œì„±í™”
   */
  experimentalStudio: true,      // Cypress Studio (í…ŒìŠ¤íŠ¸ ë…¹í™”)
  experimentalWebKitSupport: false, // WebKit ë¸Œë¼ìš°ì € ì§€ì›

  // ====================================
  // ê¸°íƒ€ ì„¤ì •
  // ====================================

  /**
   * íŒŒì¼ ê°ì‹œ ëª¨ë“œ
   * true: íŒŒì¼ ë³€ê²½ ì‹œ ìë™ ì¬ì‹¤í–‰
   */
  watchForFileChanges: true,

  /**
   * í¬ë¡¬ ì›¹ ë³´ì•ˆ ë¹„í™œì„±í™”
   * ê°œë°œ í™˜ê²½ì—ì„œ CORS ë¬¸ì œ í•´ê²°ìš©
   * âš ï¸ í”„ë¡œë•ì…˜ì—ì„œëŠ” ë¹„ê¶Œì¥
   */
  chromeWebSecurity: false,

  /**
   * ë¸Œë¼ìš°ì €ë³„ ì„¤ì •
   */
  browser: 'chrome'
})

/*
 * ====== Cypress ì„¤ì • ê°€ì´ë“œ ======
 *
 * 1. ì„¤ì¹˜ ë°©ë²•:
 *
 *    npm install -D cypress
 *    
 *    # ë˜ëŠ” yarn
 *    yarn add -D cypress
 *
 * 2. í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë°©ë²•:
 *
 *    # ëŒ€í™”í˜• ëª¨ë“œ (GUI)
 *    npx cypress open
 *
 *    # í—¤ë“œë¦¬ìŠ¤ ëª¨ë“œ (CLI)
 *    npx cypress run
 *
 *    # íŠ¹ì • ìŠ¤í™ íŒŒì¼ë§Œ ì‹¤í–‰
 *    npx cypress run --spec "cypress/e2e/auth.cy.js"
 *
 *    # íŠ¹ì • ë¸Œë¼ìš°ì €ë¡œ ì‹¤í–‰
 *    npx cypress run --browser chrome
 *
 * 3. package.json ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€:
 *
 *    "scripts": {
 *      "cy:open": "cypress open",
 *      "cy:run": "cypress run",
 *      "cy:run:headed": "cypress run --headed",
 *      "test:e2e": "cypress run"
 *    }
 *
 * 4. í´ë” êµ¬ì¡°:
 *
 *    cypress/
 *    â”œâ”€â”€ e2e/              # E2E í…ŒìŠ¤íŠ¸ íŒŒì¼
 *    â”‚   â”œâ”€â”€ auth.cy.js
 *    â”‚   â””â”€â”€ board.cy.js
 *    â”œâ”€â”€ fixtures/         # í…ŒìŠ¤íŠ¸ ë°ì´í„° (JSON)
 *    â”‚   â””â”€â”€ users.json
 *    â”œâ”€â”€ support/          # ì§€ì› íŒŒì¼
 *    â”‚   â”œâ”€â”€ commands.js   # ì»¤ìŠ¤í…€ ëª…ë ¹ì–´
 *    â”‚   â””â”€â”€ e2e.js        # ì „ì—­ ì„¤ì •
 *    â”œâ”€â”€ screenshots/      # ì‹¤íŒ¨ ì‹œ ìŠ¤í¬ë¦°ìƒ·
 *    â””â”€â”€ videos/           # í…ŒìŠ¤íŠ¸ ì˜ìƒ
 *
 * ì‘ì„±ì¼: 2025ë…„ 11ì›” 30ì¼ (41ì¼ì°¨)
 */